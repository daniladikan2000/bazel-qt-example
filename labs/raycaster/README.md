# 2D Рейкастер

Реализован 2D-рейкастер с использованием Qt, включающий следующие возможности:

- **Динамический источник света**: Управление положением источника света с помощью мыши.
- **Многоугольники-препятствия**: Создание и визуализация многоугольников, которые блокируют свет и создают тени.
- **Визуализация освещенных областей и теней**: Отображение зон, освещенных источником света, с учетом препятствий.
- **Автоматический многоугольник**: Границы окна приложения автоматически формируют многоугольник, ограничивающий область освещения.

## Реализованный функционал

### Основные компоненты

1. **Ray** - класс, представляющий луч:
   - `Rotate(angle)`: Поворот луча на заданный угол.
   - Геттеры и сеттеры для начальной и конечной точек, а также угла наклона.

2. **Polygon** - класс многоугольника:
   - Методы добавления (`AddVertex`) и обновления вершин (`UpdateLastVertex`).
   - `IntersectRay()`: Определение точки пересечения луча с многоугольником.
   - `Complete()` и `IsComplete()`: Управление состоянием завершенности многоугольника.

3. **Controller** - управляющий класс:
   - Управление коллекцией многоугольников: добавление (`AddPolygon`), обновление (`UpdateLastPolygon`), очистка (`ClearPolygons`).
   - Алгоритмы расчета освещения:
      - `CastRays()`: Генерация лучей от источника света к вершинам многоугольников.
      - `IntersectRays()`: Поиск ближайших точек пересечения лучей с многоугольниками.
      - `RemoveAdjacentRays()`: Удаление близко расположенных лучей для оптимизации.
      - `CreateLightArea()`: Формирование области освещения на основе пересечений лучей.
   - Управление источником света: установка позиции (`SetLightSource`) и цвета (`GetColor`).

4. **Canvas** - класс для отрисовки и взаимодействия с пользователем:
   - Отрисовка многоугольников и области освещения.
   - Обработка событий мыши для создания многоугольников и управления светом.
   - Поддержка автоматического многоугольника, соответствующего границам окна.

5. **MainWindow** - основной класс окна приложения:
   - Интерфейс с выпадающим меню для переключения режимов.
   - Интеграция компонентов Canvas и Controller.

### Режимы работы

1. **Режим Light**:
   - Динамическое управление источником света с помощью мыши (перемещение и клики).
   - Визуализация области освещения с учетом теней от многоугольников.

2. **Режим Polygons**:
   - Создание многоугольников:
      - **ЛКМ**: Добавить новую вершину к текущему многоугольнику.
      - **ПКМ**: Завершить создание текущего многоугольника.
   - Поддержка динамического обновления последней вершины при перемещении мыши.

### Управление

- **Переключение режимов**:
   - Через выпадающее меню (`QComboBox`) в интерфейсе приложения, выбор между "Light" и "Polygons".
- **Мышь**:
   - В режиме Light: Перемещение мыши или клик ЛКМ для установки позиции источника света.
   - В режиме Polygons: ЛКМ для добавления вершин, ПКМ для завершения многоугольника.

### Дополнительные функции

- **Автоматический многоугольник**: При инициализации и изменении размера окна создается многоугольник, соответствующий границам окна, для ограничения освещения.
- **Множественные источники света**: Поддержка нескольких источников света , расположенных по окружности вокруг основного источника в режиме Light для создания мягкого освещения. Каждому  из источников света соответствует полупрозрачная освещенная плоскость. За счет наложения таких плоскостей друг на друга создастся эффект полутеней.


## Сборка и запуск

Проект использует Bazel для сборки. Убедитесь, что Bazel и зависимости Qt установлены.
Для запуска приложения выполните следующую команду:

```bash
bazel run //labs/raycaster:raycaster
```

